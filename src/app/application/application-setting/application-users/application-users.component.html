<div class="tab-bar">
  <div class="d-flex d-flex align-items-center">
    <div class="h6 m-0 p-0">Users
      <!-- <a href="javascript:void(0)" class="ml-1" (click)="openCreateUserModal()"
          tooltip="Add User" placement="bottom"><em class="fas fa-plus"></em></a> -->
      <ng-container *ngIf="decodedToken?.privileges && decodedToken.privileges.indexOf('UMM') > -1">
        <button type="button" class="btn btn-sm searchBtn btn-primary" (click)="openCreateUserModal()"
          placement="bottom" tooltip="Add User"><em class="fas fa-plus fa-sm"></em></button>
      </ng-container>
    </div>
  </div>
</div>
<div class="tableFixHead table-responsive">
  <table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">Email</th>
        <th scope="col">Full Name</th>
        <th scope="col">Role</th>
        <th scope="col">Access Level</th>
        <th scope="col"*ngIf="decodedToken?.privileges && decodedToken.privileges.indexOf('UMM') > -1">Action</th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngIf="users.length > 0 && !isGetUsersAPILoading">
        <tr *ngFor="let user of users">
          <td>{{ user.user_email }}</td>
          <td>{{ user.user_name }}</td>
          <td>{{ user.role }}</td>
          <td>{{ getUserHierarchy(user) }}</td>
          <td>
            <span *ngIf="decodedToken?.privileges && decodedToken.privileges.indexOf('UMM') > -1 && rolesList.indexOf(user.role) >= 0 && user.isEditable">
              <a href="javascript:void(0)" (click)="openCreateUserModal(user)" class="mr-1" placement="bottom"
                tooltip="Edit User">
                <em class="fa fa-fw fa-edit"></em>
              </a>
              <a href="javascript:void(0)" (click)="openDeleteUserModal(user)" class="mr-1" placement="bottom"
                tooltip="Delete User">
                <em class="fa fa-fw fa-trash"></em>
              </a>
            </span>
          </td>
        </tr>
      </ng-container>
      <ng-container *ngIf="isGetUsersAPILoading">
        <tr>
          <td colspan="5"><em class="fa fa-spinner fa-spin fa-fw fa-2x"></em></td>
        </tr>
      </ng-container>
      <ng-container *ngIf="!isGetUsersAPILoading && users.length === 0">
        <tr>
          <td colspan="5"> No Users available.</td>
        </tr>
      </ng-container>

    </tbody>
  </table>
</div>

<div class="modal right fade" id="createUserModal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel2">
  <div class="modal-dialog" role="document">
    <div class="modal-content" *ngIf="addUserObj">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">{{addUserObj.id ? 'Edit': 'Add New'}} User</h5>
        <button type="button" class="close" [disabled]="isCreateUserAPILoading" (click)="onCloseCreateUserModal()">
          <span aria-hidden="true" tooltip="Close">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="addUserForm">
          <div class="form-group">
            <label for="message-text" class="col-form-label required">App Name:</label>
            <input type="text" class="form-control form-control-sm" id="app" [defaultValue]="applicationData.app"
              disabled />
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label required">User Full Name:</label>
            <input type="text" class="form-control form-control-sm" name="user_name" id="user_name"
              placeholder="Enter User name" formControlName="name" />
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label required">User Email:</label>
            <input type="email" pattern="^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$"
              class="form-control form-control-sm" id="user_email" name="user_email" placeholder="Enter User Email"
              formControlName="email" />
          </div>
          <ng-container formGroupName="metadata">
            <div class="form-group">
              <label for="message-text" class="col-form-label">User Mobile No (To receive SMS):</label>
              <ngx-intl-tel-input [enableAutoCountrySelect]="true" [enablePlaceholder]="true" name="user_no"
                [searchCountryFlag]="true" [cssClass]="'custom'" [inputId]="'sms'" formControlName="sms"
                [phoneValidation]="true" id="sms_no_control" [customPlaceholder]="'Enter User SMS No'"
                [selectedCountryISO]="countryISO.India" [maxLength]="15"
                [searchCountryField]="[searchCountryField.Iso2, searchCountryField.Name]">
              </ngx-intl-tel-input>
            </div>
            <div class="form-group">
              <label for="message-text" class="col-form-label">User Mobile No (To receive Whatsapp Message):</label>
              <ngx-intl-tel-input [enableAutoCountrySelect]="true" [enablePlaceholder]="true" name="whatsapp"
                [searchCountryFlag]="true" [cssClass]="'custom'" formControlName="whatsapp" [phoneValidation]="true"
                [customPlaceholder]="'Enter User Whatsapp No'" [inputId]="'whatsapp'"
                [selectedCountryISO]="countryISO.India" id="whatsapp_no_control" [maxLength]="15"
                [searchCountryField]="[searchCountryField.Iso2, searchCountryField.Name]">
              </ngx-intl-tel-input>
            </div>
          </ng-container>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label required">Role:</label>
            <select class="form-control form-control-sm" id="role" (change)="onUserRoleChange()" name="role"
              formControlName="role">
              <option [ngValue]="role.role" *ngFor="let role of userRoles">{{role.role}}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label">Access Level:</label>
            <input type="text" class="form-control form-control-sm" id="user_email"
              [defaultValue]="getAccessLevelHierarchy()" disabled />
          </div>
          <div class="form-group" *ngFor="let hierarchyItem of hierarchyList; let hIndex = index">
            <label for="message-text" class="col-form-label required">{{hierarchyItem}}:</label>
            <select class="form-control form-control-sm" id="hierarchy{{hIndex}}" name="hierarchy{{hIndex}}" [disabled]="hierarchyItem!='App' && applicationData?.user?.hierarchy[hierarchyItem]"
              [(ngModel)]="configureHierarchy[hIndex]" (change)="onChangeOfHierarchy(hIndex)" *ngIf="hIndex !== 0"
              [ngModelOptions]="{standalone: true}">
              <option [ngValue]="undefined">Select {{hierarchyItem}}</option>
              <option [ngValue]="tag" *ngFor="let tag of hierarchyArr[hIndex]">{{tag}}</option>
            </select>
            <input type="text" *ngIf="hIndex === 0" defaultValue="{{applicationData.app}}" disabled
              class="form-control form-control-sm">
          </div>
        </form>
      </div>
      <div class="modal-footer">

        <button type="button" class="btn btn-primary add-row" (click)="onCreateUser()"
          [disabled]="isCreateUserAPILoading">
          Save
          <em class="fa fa-spinner fa-spin fa-fw fa-2x" *ngIf="isCreateUserAPILoading"></em>
        </button>
        <button type="button" class="btn btn-secondary" [disabled]="isCreateUserAPILoading"
          (click)="onCloseCreateUserModal()">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="deleteUserModal" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Delete User Access</h5>
        <button type="button" class="close" aria-label="Close" (click)="onCloseModal()"
          [disabled]="isDeleteUserAPILoadig">
          <span aria-hidden="true" tooltip="Close">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to remove this user?</p>
        <!-- <p class="alert-warning">Note: User Access termination may take up-to 24 hrs.</p> -->
        <!-- <form>
          <div class="form-group">
            <label for="message-text" class="col-form-label required">Email:</label>
            <input type="text" class="form-control form-control-sm form-control form-control-sm" id="email" name="email"
              [(ngModel)]="userData.email" placeholder="Enter Email" disabled>
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label required">Password:</label>
            <input type="{{this.isPasswordVisible ? 'text' : 'password'}}" class="form-control form-control-sm"
              id="display_name" name="display_name" [(ngModel)]="password" placeholder="Enter Your Password">
            <em class="fa fa-fw  field-icon-small toggle-password" (click)="togglePasswordVisibility()"
              [ngClass]="{'fa-eye' : !this.isPasswordVisible, 'fa-eye-slash': this.isPasswordVisible}"></em>
          </div>
        </form> -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="deleteUser()" [disabled]="isDeleteUserAPILoadig">
          Delete</button>
        <button type="button" class="btn btn-secondary" (click)="onCloseModal()" [disabled]="isDeleteUserAPILoadig">
          Cancel
        </button>
        <em class="fa fa-spinner fa-spin fa-fw fa-2x" *ngIf="isDeleteUserAPILoadig"></em>
      </div>
    </div>

  </div>
</div>
