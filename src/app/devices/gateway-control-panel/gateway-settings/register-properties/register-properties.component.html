<div class="table-responsive">
  <div class="tableFixHead" >
<i class="fa fa-spinner fa-spin fa-fw fa-2x" *ngIf="isDevicesAPILoading"></i>
  <table class="table table-hover" *ngIf="!isDevicesAPILoading">
    <thead>
      <tr>
        <th>Device</th>
        <th>App</th>
        <th>Model</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngIf="devices.length > 0 && !isDevicesAPILoading">
      <tr  *ngFor="let device of devices; let i = index">
        <td>
            {{device.display_name || device.tags?.display_name}}
        </td>
        <td>{{device?.metadata?.package_app || 'NA'}}</td>
        <!-- <td >{{device.metadata?.package_app && deviceTwin.twin_properties.reported.registered_devices[device.metadata.package_app] ? (deviceTwin.twin_properties.reported?.registered_devices[device?.metadata?.package_app]?.indexOf(device.device_id) > -1 ? 'Registered' : 'Not Registered') : 'Not Registered'}}</td> -->
        <td>{{device.device_type || device.tags?.device_type}}</td>
        <td>
          {{device.appObj ? (
            deviceTwin.twin_properties.reported && deviceTwin.twin_properties.reported[device.appObj.type] &&
             deviceTwin.twin_properties.reported[device.appObj.type][device.appObj.name]
             && deviceTwin.twin_properties.reported[device.appObj.type][device.appObj.name].device_configuration
              && deviceTwin.twin_properties.reported[device.appObj.type][device.appObj.name].device_configuration[device.device_id] ? 'Registered' : 'Not Registered') : 'Not Registered'}}
        </td>
        <td> <a
          class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm mr-2"
          href="javascript:void(0)" [class.disabled]="!device.register_enabled"
          (click)="openRegisterPropModal(device)"
          ><i class="fa fa- fa-sm text-white-50"></i> Register</a></td>
      </tr>
    </ng-container>
    <ng-container *ngIf="devices.length === 0 && !isDevicesAPILoading">
      <tr>
        <td colspan="5">No devices available.</td>
      </tr>
    </ng-container>
    </tbody>
  </table>
</div>
</div>

<div class="modal fade" id="confirmMessageModal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel2" style="z-index: 1400;">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Register Properties/Alerts</h5>
        <button type="button" class="close"  aria-label="Close"  (click)="onModalClose()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div>
          <ng-container *ngIf="selectedDevice">
            <p class="alert-warning" *ngIf="!selectedDevice.model_freeze">Please freeze asset model first.</p>
          </ng-container>
        <ng-container *ngIf="showPropOptions">
          <div>
            <input type="checkbox" name="alerts"
              id="alerts" [(ngModel)]="optionsValue.alerts" />
              <label class="ml-1 form-label">Alerts</label>
              &nbsp;&nbsp;&nbsp;
            <input type="checkbox" name="measured_properties"
                id="measured_properties" [(ngModel)]="optionsValue.measured_properties" />
            <label class="ml-1 form-label">Measured Properties</label>
            &nbsp;&nbsp;&nbsp;
            <input type="checkbox" name="readable_properties"
            id="readable_properties" [(ngModel)]="optionsValue.readable_properties" />
            <label class="ml-1 form-label">Readable Properties</label>
            </div>
            <div>
              <input type="checkbox" name="writable_properties"
                  id="writable_properties" [(ngModel)]="optionsValue.writable_properties" />
              <label class="ml-1 form-label">Writable Properties</label>
              &nbsp;&nbsp;&nbsp;
              <input type="checkbox" name="derived_properties"
              id="derived_properties" [(ngModel)]="optionsValue.derived_properties" />
              <label class="ml-1 form-label">Derived Properties</label>
              </div>
        </ng-container>
        <ng-container *ngIf="displyaMsgArr.length > 0">
          <ul>
            <li *ngFor="let msg of displyaMsgArr; let last = last;">
              {{msg.message}}
              <i class="fa fa-check" style="color: green;" *ngIf="!msg.error"></i>
              <i class="fa fa-times" style="color: red;" *ngIf="msg.error"></i>
              </li>
          </ul>
        </ng-container>
        <i class="fa fa-spinner fa-spin fa-fw fa-2x" *ngIf="isAPILoading"></i>
        </div>
      </div>
      <div class="modal-footer">
        <button  type="button" class="btn btn-primary" *ngIf="showPropOptions" (click)="registerProperties()">
          Register
        </button>
        <button  type="button" class="btn btn-secondary" (click)="onModalClose()">
          Close
        </button>
      </div>
    </div>

  </div>
</div>
