<div class="blue-nav-bar" *ngIf="selectedTab === 'telemetry'">
  <div class="d-flex align-items-center">
    <div class="d-flex align-items-center">
      <div class="main-heading ">{{(tileData && tileData[0] ? tileData[0]?.value : '')}}</div>
      <div class="ml-2 pt-15"
        *ngIf="decodedToken?.privileges?.indexOf('RCC') > -1 && signalRModeValue !== undefined && selectedTab === 'telemetry' && contextApp?.dashboard_config?.show_live_widgets">
        Turbo Mode:</div>
      <div class="ml-1 pt-15"
        *ngIf="decodedToken?.privileges?.indexOf('RCC') > -1 && signalRModeValue !== undefined && selectedTab === 'telemetry' && contextApp?.dashboard_config?.show_live_widgets">
        <ui-switch size="small" class="mr-1" defaultBgColor="red" [disabled]="isC2dAPILoading"
          uncheckedTextColor="white" switchColor="#EFEFEF" checkedTextColor="white" checkedLabel="ON"
          uncheckedLabel="OFF" name="tpye" [(ngModel)]="signalRModeValue" (valueChange)="onSwitchValueChange($event)">
          <em class="fa fa-check" style="color: green;" *ngIf="signalRModeValue"></em>
          <em class="fa fa-times" style="color: red" *ngIf="!signalRModeValue"></em>
        </ui-switch>
      </div>
    </div>
    <div class="ml-auto">
      <div class="">
        <form class="form-inline">
          <app-hierarchy-dropdown #hierarchyDropdown *ngIf="filterObj" [showAsset]="true" [closeOnSelection]="false" [filterObj]="filterObj"
            [assets]="assets" (saveHierarchyEvent)="onSaveHierachy()" (clearHierarchyEvent)="onClearHierarchy()">
          </app-hierarchy-dropdown>
          <div class="form-group"><button type="button" class="btn btn-sm searchBtn btn-primary"
              (click)="onFilterSelection(this.filterObj, true, true)" [disabled]="isTelemetryDataLoading"><em
                class="fas fa-search fa-sm"></em></button></div>
        </form>
      </div>
    </div>
  </div>
</div>
<div class="tab-bar">
  <ng-container>
    <div class=""
      *ngIf="!isTelemetryDataLoading && telemetryObj && isFilterSelected && originalFilter?.asset && liveWidgets.length > 0">
      <div class="">Welcome to {{originalFilter.asset?.display_name ? originalFilter.asset?.display_name :
        originalFilter.asset?.asset_id}}</div>
    </div>
    <ng-container *ngIf="contextApp?.dashboard_config?.show_live_widgets">
      <div class="" *ngIf="!isTelemetryDataLoading && !telemetryObj && isFilterSelected">
        No data available since mid night.
      </div>
      <div class="ml-1" *ngIf="liveWidgets.length === 0 && isFilterSelected
          ">
        No {{widgetStringFromMenu}} configured for this asset. Please contact administrator.
      </div>
      <div class="ml-auto"
        *ngIf="!isTelemetryDataLoading && telemetryObj && isFilterSelected && originalFilter?.asset && liveWidgets.length > 0">
        <div class="">*{{sampleCountValue}} samples in last 1 minute
        </div>
      </div>
    </ng-container>

    <div class="" *ngIf="!isFilterSelected">
      Please select an asset and click on search to view the data.
    </div>


  </ng-container>
  <div class="form-group mb-0">
    <ng-template #filterTemplate>
      <form class="form-inline">
        <div class="form-group">
          <ng-select [items]="historicalWidgets" class="custom-dropdown w-12 active sm" bindLabel="chart_Id"
            [clearable]="false" [searchable]="true" clearSearchOnAdd="true" [multiple]="true" [closeOnSelect]="false"
            placeholder="Select {{widgetStringFromMenu}}" dropdownPosition="bottom" name="asset-dropdown"
            [(ngModel)]="historicalDateFilter.widgets" (onDeSelectAll)="onDeSelectAll($event)">
            <ng-template ng-multi-label-tmp let-items="items">
              {{items.length}} {{widgetStringFromMenu}} selected
            </ng-template>
            <ng-template ng-header-tmp>
              <ul style="list-style-type:none;line-height: 1.5rem;" class="m-0 p-0">
                <li *ngIf="historicalWidgets.length !== historicalDateFilter?.widgets.length"> <a
                    href="javascript:void(0)" (click)="historicalDateFilter.widgets = historicalWidgets">Select All</a>
                </li>
                <li *ngIf="historicalWidgets.length === historicalDateFilter?.widgets.length"> <a
                    href="javascript:void(0)" (click)="historicalDateFilter.widgets = []">Deselect All</a></li>
              </ul>
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              <span [tooltip]="item.title">
                {{item.title}}
              </span>
            </ng-template>
          </ng-select>
        </div>
        <app-date-range-picker *ngIf="historicalDateFilter.from_date && historicalDateFilter.to_date"
          [filterObj]="historicalDateFilter" (selectedDateApplyEmitter)="selectedDate($event)"
          [selectedDateRange]="selectedDateRange">
        </app-date-range-picker>
        <div class="form-group">
          <input type="checkbox" id="checkbox" min="1" name="checkbox" class="big-checkbox"
            [(ngModel)]="historicalDateFilter.isTypeEditable" (change)="historicalDateFilter.aggregation_format = 'AVG'; historicalDateFilter.aggregation_minutes = 1;
          historicalDateFilter.sampling_format = 'minute'; historicalDateFilter.sampling_time = 1;">
        </div>
        <div class="form-group">
          <fieldset [disabled]="!historicalDateFilter.isTypeEditable">
            <ui-switch [disabled]="!historicalDateFilter.isTypeEditable" defaultBgColor="#1a5a9e"
              checkedTextColor="white" uncheckedTextColor="white" checkedLabel="Sampling" (valueChange)="historicalDateFilter.aggregation_format = 'AVG'; historicalDateFilter.aggregation_minutes = 1;
            historicalDateFilter.sampling_format = 'minute'; historicalDateFilter.sampling_time = 1;
            " uncheckedLabel="Aggregation" [(ngModel)]="historicalDateFilter.type" name="tpye"></ui-switch>
          </fieldset>
        </div>
        <div class="form-group input-group" *ngIf="historicalDateFilter.type">

          <input class="form-control form-control-sm bg-light" type="number" id="minutes" min="1" name="minutes"
            [(ngModel)]="historicalDateFilter.sampling_time" placeholder="Sampling" disabled placement="bottom"
            tooltip="By default this is 1 minute. Right now this field is disabled. Dynamic selection of sampling frequency is under development."
            style="width: 3em;">
          <div class="form-group pl-2">
            <select class="form-control form-control-sm" id="samplingFormat"
              [(ngModel)]="historicalDateFilter.sampling_format" name="samplingFormat" style="width: 11rem!important;"
              [disabled]="!historicalDateFilter.isTypeEditable"
              [ngClass]="{'active': historicalDateFilter.sampling_format}">
              <option [ngValue]="undefined">Sampling Format</option>
              <option [ngValue]="'minute'">Minute</option>
              <option [ngValue]="'hour'">Hour</option>
              <option [ngValue]="'day'">Day</option>
              <option [ngValue]="'week'">Week</option>
              <option [ngValue]="'month'">Month</option>
            </select>
          </div>
        </div>
        <div class="form-group input-group" *ngIf="!historicalDateFilter.type">
          <fieldset [disabled]="!historicalDateFilter.isTypeEditable"></fieldset>
          <input class="form-control form-control-sm bg-light" type="number" id="aggr_mins" min="1" name="aggr_mins"
            [(ngModel)]="historicalDateFilter.aggregation_minutes" placeholder="Sampling"
            (change)="onNumberChange($event, 'aggregation')" [disabled]="!historicalDateFilter.isTypeEditable"
            style="width: 4em;">
          <div class="input-group-append"><span class="input-group-text bg-light">mins</span></div>
        </div>
        <div class="form-group " *ngIf="!historicalDateFilter.type">
          <fieldset [disabled]="!historicalDateFilter.isTypeEditable">
            <select class="form-control form-control-sm" id="aggregationFormat"
              [(ngModel)]="historicalDateFilter.aggregation_format" name="aggregationFormat"
              style="width: 11rem!important;">
              <option [ngValue]="undefined">Aggregartion Format</option>
              <option [ngValue]="'AVG'">Average</option>
              <option [ngValue]="'SUM'">Sum</option>
              <option [ngValue]="'MIN'">Min</option>
              <option [ngValue]="'MAX'">Max</option>
              <option [ngValue]="'COUNT'">Count</option>
            </select>
          </fieldset>
        </div>

        <div class="form-group">
          <button type="button" class="btn btn-sm searchBtn btn-primary" placement="bottom" tooltip="Search"
            (click)="onFilterSelection(this.filterObj,true,false,false)">
            <em class="fa fa-search fa-sm"></em>
          </button>
        </div>
      </form>
    </ng-template>

    <ng-container *ngIf="isShowOpenFilter && isFilterSelected && contextApp?.dashboard_config?.show_historical_widgets">
      <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
    </ng-container>
    <ng-container
      *ngIf="!isShowOpenFilter && isFilterSelected && contextApp?.dashboard_config?.show_historical_widgets">
      <button href="#" role="button" class="dropdown-btn" data-toggle="dropdown" placement="bottom" aria-haspopup="true"
        aria-expanded="false">
        <em class="fas fa-fw fa-filter fa-sm button-divider"></em>
        Select Filter</button>
      <div class="dropdown-menu dropdown-filter-content" style="position: relative !important;">
        <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
      </div>
    </ng-container>
  </div>
</div>
<ng-container>
  <div class="content-scroll content-scroll-live-data">
    <div class="pl-3 pt-3" *ngIf="isTelemetryDataLoading">
      <em class="fa fa-spinner fa-spin fa-fw fa-2x"></em>
    </div>
    <ng-container *ngIf="contextApp?.dashboard_config?.show_historical_widgets">
      <div class="m-3" *ngIf="historicalWidgets.length === 0 && isFilterSelected
      ">
        No {{widgetStringFromMenu}} configured for this asset. Please contact administrator.
      </div>
      <!-- <div class="m-3" *ngIf="historicalWidgets.length > 0 && !isTelemetryDataLoading && telemetryData.length === 0 && isFilterSelected
      ">
        No telemetry data found for selected interval.
      </div> -->
    </ng-container>
    <ng-container *ngIf="(!contextApp || !contextApp.metadata || !contextApp.dashboard_config) && isFilterSelected">
      <div class="ml-1">No dashboard configuration added for this application.</div>
    </ng-container>
    <div class="row col-md-12 mt-n2"
      *ngIf="telemetryObj && liveWidgets.length > 0 && contextApp?.dashboard_config?.show_live_widgets && originalFilter?.asset">
      <ng-container *ngFor="let widget of liveWidgets; let i = index;">
        <div [style]="{ 'width': widget?.widgetType === 'OnlyNumber' || widget?.widgetType === 'NumberWithTrend'
              || widget?.widgetType === 'NumberWithImage' || widget.widgetType === 'RectangleWidget' || widget.widgetType === 'CylinderWidget' || widget.widgetType === 'GaugeChart' || widget.widgetType === 'StringWidget'? (23 * widget.properties.length + (widget.properties.length > 1 ? (2 * (widget.properties.length - 1)) : 0) +'%') : '48%',
              'margin-left':'2%', 'margin-top': '2%'}">
          <app-only-number-widget *ngIf="widget?.widgetType === 'OnlyNumber' || widget?.widgetType === 'NumberWithTrend'
              || widget?.widgetType === 'NumberWithImage' || widget?.widgetType === 'StringWidget'"
            [chartConfig]="widget" [asset]="originalFilter?.asset" [apiTelemetryObj]="apiTelemetryObj"
            [telemetryObj]="telemetryObj">
          </app-only-number-widget>
          <app-rectangle-widget [chartConfig]="widget" [asset]="originalFilter?.asset"
            *ngIf="widget.widgetType === 'RectangleWidget'" [telemetryObj]="telemetryObj">
          </app-rectangle-widget>
          <app-cylinder-widget [chartConfig]="widget" [asset]="originalFilter?.asset"
            *ngIf="widget.widgetType === 'CylinderWidget'" [telemetryObj]="telemetryObj">
          </app-cylinder-widget>
          <app-gauge-chart [chartConfig]="widget" [asset]="originalFilter?.asset"
            *ngIf="widget.widgetType === 'GaugeChart'" [telemetryObj]="telemetryObj"
            [apiTelemetryObj]="apiTelemetryObj"></app-gauge-chart>
          <app-live-line-chart [chartConfig]="widget" [asset]="originalFilter?.asset" [telemetryObj]="telemetryObj"
            *ngIf="widget.widgetType === 'LineChart' || widget.widgetType === 'AreaChart'">
          </app-live-line-chart>
        </div>
      </ng-container>
      <ng-container *ngIf="defaultAppName === 'SopanCMS'">
        <div style="width:23%;margin-left:2%;margin-top: 2%">
          <div class="mt-1">
            <div class="card">
              <div class="card-header d-flex px-2">
                <div>
                  <h6 class="my-0 live-widget-title">
                    Since Beginning
                  </h6>
                </div>
                <div class="ml-auto">
                  <div class="round-badge badge-blue" tooltip="Measured Property">M</div>
                </div>
              </div>
              <div class="card-body1" style="height: 12rem;">
                <div class="row text-center " *ngIf="telemetryObj">
                  <div class="col-md-12">
                    <span class="text-xs">(M) HH:MM</span>
                    <div class="mt-4">
                      <span class="text-darkblue display-5 font-weight-bold" style="font-size: 2rem;">
                        <!-- {{telemetryObj[prop.property.json_key]}} -->
                        {{ latestRunningHours + ':' +
                        latestRunningMinutes}}
                      </span>
                    </div>
                    <div>
                      <span class="text-darkblue display-5">
                        {{telemetryObj.date}}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div style="width:23%;margin-left:2%;margin-top: 2%">
          <div class="mt-1">
            <div class="card">
              <div class="card-header d-flex px-2">
                <div>
                  <h6 class=" my-0  live-widget-title ">
                    Since Mid-Night
                  </h6>
                </div>
                <div class="ml-auto">

                  <div class="round-badge badge-blue" tooltip="Measured Property">M</div>
                </div>
              </div>
              <div class="card-body1" style="height: 12rem;">
                <div class="row text-center " *ngIf="telemetryObj">
                  <div class="col-md-12">
                    <span class="text-xs">(M) HH:MM</span>
                    <div class="mt-4">
                      <span class="text-darkblue display-5 font-weight-bold" style="font-size: 2rem;"
                        *ngIf="currentHour !== undefined && currentHour !== null && currentMinute  !== undefined && currentMinute  !== null ">
                        <!-- {{telemetryObj[prop.property.json_key]}} -->
                        {{currentHour}}:{{currentMinute}}
                      </span>
                    </div>
                    <div>
                      <span class="text-darkblue display-5" *ngIf="currentHour && currentMinute">
                        {{telemetryObj.date}}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
    <div class="row col-md-12"
      *ngIf="historicalWidgets.length > 0 && contextApp?.dashboard_config?.show_historical_widgets" id="mainChartDiv">
      <div id="historic_charts" class="pl-3 pt-3 w-100">

      </div>
      <!-- <div class="pl-3" *ngIf="telemetryData.length === 0 && !isTelemetryDataLoading">No Data available.</div> -->
    </div>
  </div>
</ng-container>

<!-- <ng-container *ngIf="selectedTab === 'alert'">
  <app-application-visualization [pageType]="'live'"></app-application-visualization>
</ng-container> -->
