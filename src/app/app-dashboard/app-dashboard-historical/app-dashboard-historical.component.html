<div class="blue-nav-bar">
    <div class="d-flex align-items-center">
        <div class="d-flex align-items-center">
            <div class="main-heading ">{{(tileData && tileData[0] ? tileData[0]?.value : '')}}</div>
        </div>
        <div class="ml-auto">
            <div class="">
                <form class="form-inline">
                    <app-hierarchy-dropdown #hierarchyDropdown *ngIf="filterObj" [showAsset]="true"
                        [closeOnSelection]="true" [filterObj]="filterObj" [assets]="assets"
                        (saveHierarchyEvent)="onSaveHierachy()" (clearHierarchyEvent)="onClearHierarchy()">
                    </app-hierarchy-dropdown>
                    <div class="form-group"><button type="button" class="btn btn-sm searchBtn btn-primary"
                            (click)="onFilterSelection(this.filterObj, true, true)"
                            [disabled]="isTelemetryDataLoading"><em class="fas fa-search fa-sm"></em></button></div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="tab-bar">
    <ng-container>
        <div class="" *ngIf="!isFilterSelected">
            Please select an asset and click on search to view the data.
        </div>

    </ng-container>
    <div class="form-group mb-0">
        <ng-template #filterTemplate>
            <form class="form-inline">
                <div class="form-group">
                    <ng-select [items]="historicalWidgets" class="custom-dropdown w-12 active sm" bindLabel="chart_Id"
                        [clearable]="false" [searchable]="true" clearSearchOnAdd="true" [multiple]="true"
                        [closeOnSelect]="false" placeholder="Select {{widgetStringFromMenu}}" dropdownPosition="bottom"
                        name="asset-dropdown" [(ngModel)]="historicalDateFilter.widgets"
                        (onDeSelectAll)="onDeSelectAll($event)">
                        <ng-template ng-multi-label-tmp let-items="items">
                            {{items.length}} {{widgetStringFromMenu}} selected
                        </ng-template>
                        <ng-template ng-header-tmp>
                            <ul style="list-style-type:none;line-height: 1.5rem;" class="m-0 p-0">
                                <li *ngIf="historicalWidgets.length !== historicalDateFilter?.widgets.length"> <a
                                        href="javascript:void(0)"
                                        (click)="historicalDateFilter.widgets = historicalWidgets">Select All</a>
                                </li>
                                <li *ngIf="historicalWidgets.length === historicalDateFilter?.widgets.length"> <a
                                        href="javascript:void(0)" (click)="historicalDateFilter.widgets = []">Deselect
                                        All</a></li>
                            </ul>
                        </ng-template>
                        <ng-template ng-option-tmp let-item="item">
                            <span [tooltip]="item.title">
                                {{item.title}}
                            </span>
                        </ng-template>
                    </ng-select>
                </div>
                <app-date-range-picker *ngIf="historicalDateFilter.from_date && historicalDateFilter.to_date"
                    [filterObj]="historicalDateFilter" (selectedDateApplyEmitter)="selectedDate($event)"
                    [selectedDateRange]="selectedDateRange">
                </app-date-range-picker>
                <div class="form-group">
                    <input type="checkbox" id="checkbox" min="1" name="checkbox" class="big-checkbox"
                        [(ngModel)]="historicalDateFilter.isTypeEditable" (change)="historicalDateFilter.aggregation_format = 'AVG'; historicalDateFilter.aggregation_minutes = 1;
            historicalDateFilter.sampling_format = 'minute'; historicalDateFilter.sampling_time = 1;">
                </div>
                <div class="form-group">
                    <fieldset [disabled]="!historicalDateFilter.isTypeEditable">
                        <ui-switch [disabled]="!historicalDateFilter.isTypeEditable" defaultBgColor="#1a5a9e"
                            checkedTextColor="white" uncheckedTextColor="white" checkedLabel="Sampling" (valueChange)="historicalDateFilter.aggregation_format = 'AVG'; historicalDateFilter.aggregation_minutes = 1;
              historicalDateFilter.sampling_format = 'minute'; historicalDateFilter.sampling_time = 1;
              " uncheckedLabel="Aggregation" [(ngModel)]="historicalDateFilter.type" name="tpye"></ui-switch>
                    </fieldset>
                </div>
                <div class="form-group input-group" *ngIf="historicalDateFilter.type">

                    <input class="form-control form-control-sm bg-light" type="number" id="minutes" min="1"
                        name="minutes" [(ngModel)]="historicalDateFilter.sampling_time" placeholder="Sampling" disabled
                        placement="bottom"
                        tooltip="By default this is 1 minute. Right now this field is disabled. Dynamic selection of sampling frequency is under development."
                        style="width: 3em;">
                    <div class="form-group pl-2">
                        <select class="form-control form-control-sm" id="samplingFormat"
                            [(ngModel)]="historicalDateFilter.sampling_format" name="samplingFormat"
                            style="width: 11rem!important;" [disabled]="!historicalDateFilter.isTypeEditable"
                            [ngClass]="{'active': historicalDateFilter.sampling_format}">
                            <option [ngValue]="" disabled>-- Sampling Format --</option>
                            <option [ngValue]="'minute'">Minute</option>
                            <option [ngValue]="'hour'">Hour</option>
                            <option [ngValue]="'day'">Day</option>
                            <option [ngValue]="'week'">Week</option>
                            <option [ngValue]="'month'">Month</option>
                        </select>
                    </div>
                </div>
                <div class="form-group input-group" *ngIf="!historicalDateFilter.type">
                    <fieldset [disabled]="!historicalDateFilter.isTypeEditable"></fieldset>
                    <input class="form-control form-control-sm bg-light" type="number" id="aggr_mins" min="1"
                        name="aggr_mins" [(ngModel)]="historicalDateFilter.aggregation_minutes" placeholder="Sampling"
                        (change)="onNumberChange($event, 'aggregation')"
                        [disabled]="!historicalDateFilter.isTypeEditable" style="width: 4em;">
                    <div class="input-group-append"><span class="input-group-text bg-light">mins</span></div>
                </div>
                <div class="form-group " *ngIf="!historicalDateFilter.type">
                    <fieldset [disabled]="!historicalDateFilter.isTypeEditable">
                        <select class="form-control form-control-sm" id="aggregationFormat"
                            [(ngModel)]="historicalDateFilter.aggregation_format" name="aggregationFormat"
                            style="width: 11rem!important;">
                            <option [ngValue]="" disabled>-- Aggregartion Format --</option>
                            <option [ngValue]="'AVG'">Average</option>
                            <option [ngValue]="'SUM'">Sum</option>
                            <option [ngValue]="'MIN'">Min</option>
                            <option [ngValue]="'MAX'">Max</option>
                            <option [ngValue]="'COUNT'">Count</option>
                        </select>
                    </fieldset>
                </div>

                <div class="form-group">
                    <button type="button" class="btn btn-sm searchBtn btn-primary" [disabled]="isTelemetryDataLoading"
                        placement="bottom" tooltip="Search"
                        (click)="onFilterSelection(this.filterObj,true,false,false)">
                        <em class="fa fa-search fa-sm"></em>
                    </button>
                </div>
            </form>
        </ng-template>

        <ng-container *ngIf="isShowOpenFilter && isFilterSelected">
            <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
        </ng-container>
        <ng-container *ngIf="!isShowOpenFilter && isFilterSelected">
            <button href="#" role="button" class="dropdown-btn" data-toggle="dropdown" placement="bottom"
                aria-haspopup="true" aria-expanded="false">
                <em class="fas fa-fw fa-filter fa-sm button-divider"></em>
                Select Filter</button>
            <div class="dropdown-menu dropdown-filter-content" style="position: relative !important;">
                <ng-container *ngTemplateOutlet="filterTemplate"></ng-container>
            </div>
        </ng-container>
    </div>
</div>
<ng-container>
    <div class="content-scroll content-scroll-live-data">
        <div class="pl-3 pt-3" *ngIf="isTelemetryDataLoading">
            <em class="fa fa-spinner fa-spin fa-fw fa-2x"></em>
        </div>
        <ng-container>
            <div class="m-3" *ngIf="historicalWidgets.length === 0 && isFilterSelected
        ">
                No {{widgetStringFromMenu}} configured for this asset. Please contact administrator.
            </div>
        </ng-container>
        <ng-container *ngIf="(!contextApp || !contextApp.metadata || !contextApp.dashboard_config) && isFilterSelected">
            <div class="ml-1">No dashboard configuration added for this application.</div>
        </ng-container>

        <div class="row col-md-12" *ngIf="historicalWidgets.length > 0 " id="mainChartDiv">
            <div id="historic_charts" class="pl-3 pt-3 w-100">

            </div>
            <!-- <div class="pl-3" *ngIf="telemetryData.length === 0 && !isTelemetryDataLoading">No Data available.</div> -->
        </div>
    </div>
</ng-container>