<div class="topnavbar">
  <div class="d-sm-flex align-items-center justify-content-start mb-2 mt-n3 pl-1">
    <h5 class="h4 mb-0 text-gray-800">{{tileData && tileData[0] ? tileData[0]?.value : ''}}</h5>
  </div>
  <div class="card row bg-white" style="margin-left:-2rem">
    <div class="col-xl-12 mb-12">
      <form>
        <div class="d-flex form-group form-inline my-2 mx-3">
          <ng-container *ngFor="let level of contextApp?.hierarchy?.levels; let index = index;">
          <select *ngIf="index !== 0" class="form-control form-control-sm mx-1 my-1" id="{{level}}"
          [disabled]="contextApp?.user?.hierarchy[level]"
          [(ngModel)]="configureHierarchy[index]" name="{{level}}" (change)="onChangeOfHierarchy(index)">
            <option [ngValue]="undefined">Select {{level}}</option>
            <option [ngValue]="tag" *ngFor="let tag of hierarchyArr[index]">
              {{tag}}
            </option>
          </select>
          <input  type="text" *ngIf="index === 0"  defaultValue="{{contextApp.app}}" disabled class="form-control form-control-sm mx-1 my-1">
        </ng-container>
        <select class="form-control form-control-sm mx-1 my-1" id="deviceCategory" [(ngModel)]="filterObj.device"
        name="deviceCategory" (change)="onAssetSelection()">
        <option [ngValue]="undefined">Select Asset</option>
        <option [ngValue]="device" *ngFor="let device of devices">
          {{device?.display_name ? device?.display_name: device.device_id}}
        </option>
        </select>
        <!-- <select class="form-control form-control-sm mx-1 my-1" id="deviceCategory1" [(ngModel)]="filterObj.non_ip_device"
          name="deviceCategory1" *ngIf="filterObj.device?.cloud_connectivity.includes('Gateway')"
          (change)="onNonIPDeviceChange()">
          <option [ngValue]="undefined">Select Asset</option>
          <option [ngValue]="device" *ngFor="let device of nonIPDevices">
            {{device?.display_name ? device?.display_name: device.device_id}}
          </option>
        </select> -->
        </div>
        <div class="d-flex row form-group form-inline  my-2 mx-3">

          <!-- <input type="number" min="1" class="form-control form-control-sm mx-1 my-1 record-input" id="inputEmail4"
            placeholder="No of Records" [(ngModel)]="filterObj.count" name="count"> -->

          <select class="form-control form-control-sm mr-2 ml-1 my-1" id="report_type" [(ngModel)]="filterObj.report_type"
          name="report_type" (change)="onNonIPDeviceChange()">
          <option [ngValue]="undefined">Select Report Type</option>
          <option [ngValue]="'Process Parameter Report'">Process Parameter Report</option>
          <option [ngValue]="'Alert Report'">Alert Report</option>
          </select>
          <angular2-multiselect [data]="dropdownPropList" id="y1AxisProperty" *ngIf=" filterObj.report_type === 'Process Parameter Report'"
              [(ngModel)]="props" name="props" [settings]="{
                text: 'Select Property',
                selectAllText: 'Select All',
                unSelectAllText: 'UnSelect All',
                classes: 'col-lg-2 col-xl-2 p-0 mx-1',
                enableSearchFilter: true,
                badgeShowLimit: 1,
                maxHeight: 200,
                labelKey: 'id'
              }"
              (onDeSelectAll)="y1Deselect($event)">
            </angular2-multiselect>
            <div class="bg-dateRow form-group form-inline" id="dateRow"
            [style.width]="(filterObj.dateOption === 'date' ? '23rem' : (filterObj.dateOption === 'date range' ? '35rem' : ''))">
          <select class="form-control form-control-sm mx-1 my-1" id="dateoptions" [(ngModel)]="filterObj.dateOption"
            name="dateOptions" (change)="onDateOptionChange()">
            <option [ngValue]="undefined">Quick Date Options</option>
            <option [ngValue]="'5 mins'">Last 5 minutes</option>
            <option [ngValue]="'30 mins'">Last 30 minutes</option>
            <option [ngValue]="'1 hour'">Last 1 hour</option>
            <option [ngValue]="'24 hour'">Last 24 hours</option>
            <option [ngValue]="'date'">Select Date</option>
            <option [ngValue]="'date range'">Select Date Range</option>
          </select>
          <!-- <label class="ml-1 mr-1">OR</label> -->
          <ng-container *ngIf="filterObj.dateOption === 'date'">
            <input #dt2Input [owlDateTime]="dt2"  (dateTimeChange)="onSingleDateChange($event);"
              class="form-control form-control-sm mx-2 my-1 w-10" [owlDateTimeTrigger]="dt2"
              placeholder="Select Date">
            <span [owlDateTimeTrigger]="dt2"  class="datepicker-calendar"><i class="fa fa-calendar"></i></span>
            <owl-date-time #dt2 [pickerType]="'calendar'"></owl-date-time>
          </ng-container>
          <!-- <label class="ml-3 mr-1">OR</label> -->
          <ng-container *ngIf="filterObj.dateOption === 'date range'">
            <input #dt1Input [owlDateTime]="dt1" [selectMode]="'range'" (dateTimeChange)="onDateChange($event)"
              class="form-control form-control-sm mx-2 my-1 date-range-picket-width" [owlDateTimeTrigger]="dt1"
              placeholder="Select Date Range">
            <span [owlDateTimeTrigger]="dt1" class="datepicker-calendar"><i class="fa fa-calendar"></i></span>
            <owl-date-time #dt1></owl-date-time>
          </ng-container>
          </div>
          <button type="button" class="btn btn-warning btn-sm mx-1 my-1" title="Search"
          *ngIf=" filterObj.report_type !== 'Process Parameter Report'" (click)="onFilterSelection()" ><i
            class="fa fa-search fa-sm" ></i></button>

          <!-- <bu<button type="button" class="btn btn-warning btn-sm mx-1 my-1" title="Search" (click)="onFilterSelection()" ><i
            class="fa fa-search fa-sm"></i></button>tton type="button" class="btn btn-white btn-sm mx-1 my-1" title="Clear" (click)="clear()"><i class="fa fa-trash  fa-sm"></i></button> -->

        </div>
        <div class="d-flex form-group form-inline my-2 mx-3" *ngIf=" filterObj.report_type === 'Process Parameter Report'">
          <input type="checkbox" class="mx-1 my-1 big-checkbox" id="checkbox" min="1"
            name="checkbox" [(ngModel)]="filterObj.isTypeEditable" (change)="filterObj.aggregation_format = 'AVG'; filterObj.aggregation_minutes = 1;
            filterObj.sampling_format = 'minute'; filterObj.sampling_time = 1;
            ">

            <fieldset [disabled]="!filterObj.isTypeEditable" class="form-group form-inline my-1">
            <ui-switch   class="mr-1" [disabled]="!filterObj.isTypeEditable"
            defaultBgColor="#f6c23e" checkedTextColor="white" uncheckedTextColor="white"
            checkedLabel="Sampling Frequency" (valueChange)="filterObj.aggregation_format = 'AVG'; filterObj.aggregation_minutes = 1;
            filterObj.sampling_format = 'minute'; filterObj.sampling_time = 1"
            uncheckedLabel="Aggregation" [(ngModel)]="filterObj.type" name="tpye"></ui-switch>

            <ng-container *ngIf="!filterObj.type">
            <input type="number" class="form-control form-control-sm my-1 w-7" id="minutes" min="1"
              name="minutes" [(ngModel)]="filterObj.aggregation_minutes" placeholder="Agreegation Time"
              (change)="onNumberChange($event, 'aggregation')">
            <button class="btn btn-secondary btn-sm mr-1" style="pointer-events: none;">mins</button>
            <select class="form-control form-control-sm mx-1 my-1" id="aggregationFormat" [(ngModel)]="filterObj.aggregation_format"
            name="aggregationFormat" style="width: 11rem!important;">
            <option [ngValue]="undefined">Aggregartion Format</option>
            <option [ngValue]="'AVG'">Average</option>
            <option [ngValue]="'SUM'">Sum</option>
            <option [ngValue]="'MIN'">Min</option>
            <option [ngValue]="'MAX'">Max</option>
            <option [ngValue]="'COUNT'">Count</option>
            </select>
            </ng-container>
            <ng-container *ngIf="filterObj.type">
            <input type="number" class="form-control form-control-sm ml-1 my-1 w-7" id="minutes" min="1"
              name="minutes" [(ngModel)]="filterObj.sampling_time" placeholder="Sampling" disabled
              (change)="onNumberChange($event, 'sampling')">
            <!-- <select class="form-control form-control-sm mx-1 my-1" id="samplingFrequency" [(ngModel)]="filterObj.sampling_format"
            name="samplingFrequency" style="width: 11rem!important;" disabled>
            <option [ngValue]="undefined">Frequency</option>
            <option [ngValue]="'second'">Second</option>
            <option [ngValue]="'minute'">Minute</option>
            <option [ngValue]="'hour'">Hour</option>
            </select> -->
            <button class="btn btn-secondary btn-sm mr-1" style="pointer-events: none;">mins</button>
            </ng-container>
            </fieldset>
          <button type="button" class="btn btn-warning btn-sm mx-1 my-1" title="Search" (click)="onFilterSelection()" ><i
            class="fa fa-search fa-sm"></i></button>
        </div>


      </form>
    </div>
  </div>




</div>
<div class="contain-pad-report" [style.marginTop]="filterObj.report_type === 'Process Parameter Report' ? '17.5rem' : '14.5rem'">
  <div class="mb-2">
    <h6 *ngIf="!isFilterSelected"> Please select filters to view the report data.</h6>
    <div class="table-responsive" *ngIf="isFilterSelected || isTelemetryLoading">
      <h5 >{{filterObj.report_type}}
        <a href="javascript:void(0)" (click)="savePDF()" title="Export as PDF"><i class="fa fa-sm fa-file-pdf-o" ></i></a>
        <a href="javascript:void(0)" (click)="saveExcel()" title="Export as Excel" class="ml-1"><i class="fa fa-sm fa-file-excel-o" ></i></a>

      </h5>
      <table class="table table-bordered table-striped"  id="dataTable1" width="100%" cellspacing="0"
      *ngIf="isFilterSelected && filterObj.report_type === 'Process Parameter Report'">
        <thead>
          <tr class="bg-secondary text-white">
            <th>Asset Name</th>
            <th>Time</th>
            <th *ngFor="let property of selectedProps"> {{property.id}}</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="telemetry.length > 0 && !isTelemetryLoading">
            <tr *ngFor="let telemetryObj of telemetry">

              <td>{{ filterObj.non_ip_device ?
                (filterObj.non_ip_device.device_display_name ? filterObj.non_ip_device?.device_display_name : filterObj.non_ip_device?.device_id)
              : (filterObj.device ?
              (filterObj.device.device_display_name ? filterObj.device.device_display_name : filterObj.device.device_id)
              : '' )}}</td>
              <td>{{ telemetryObj.local_created_date }}</td>
              <td *ngFor="let prop of selectedProps"> {{telemetryObj[prop.value.json_key]}}</td>
                          </tr>
          </ng-container>
          <ng-container *ngIf="telemetry.length === 0 && !isTelemetryLoading">
            <tr>
              <td [attr.colspan]="2 + selectedProps.length">No telemetry data available.</td>
            </tr>
          </ng-container>
           <ng-container *ngIf="telemetry.length === 0 && isTelemetryLoading">
            <tr>
              <td [attr.colspan]="2 + selectedProps.length">
                <i  class="fa fa-fw fa-2x  fa-spin fa-spinner"></i>
              </td>
            </tr>
          </ng-container>

        </tbody>
      </table>
      <table class="table table-bordered table-striped"  id="dataTable" width="100%" cellspacing="0"
      *ngIf="isFilterSelected && filterObj.report_type === 'Alert Report'">
        <thead>
          <tr class="bg-secondary text-white">
            <th></th>
            <th>Asset Name</th>
            <th>Time</th>
            <th>Description</th>
            <th>Status</th>
            <th>Acknowledged By</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="latestAlerts.length > 0">
            <tr *ngFor="let alert of latestAlerts" [ngClass]="{'bg-danger text-white': alert.severity?.toLowerCase() === 'critical'}">
              <td><i class="fa fa-exclamation-triangle" [style.color]="
                (alert.severity?.toLowerCase() === 'critical' ? '#cc0000' :
                (alert.severity?.toLowerCase() === 'error' ? '#fb5515' :
                (alert.severity?.toLowerCase() === 'warning' ? '#f6c23e' :
                (alert.severity?.toLowerCase() === 'informational' ? '#229954' : ''))
                )
                )" title="{{alert.severity}}"></i></td>

              <td>{{ alert.device_display_name ? alert.device_display_name : alert.device_id }}</td>

              <td>{{ alert.local_created_date }}</td>
              <td>{{ alert.message }}</td>
              <td> {{alert.metadata?.acknowledged_date ? 'Acknowledged' : 'Not Acknowledged'}}
              </td>
              <td>{{ alert.metadata?.user_id }}</td>
            </tr>
          </ng-container>
          <ng-container *ngIf="latestAlerts.length === 0 && !isTelemetryLoading">
            <tr>
              <td colspan="6">No Alert data available.</td>
            </tr>
          </ng-container>
          <ng-container *ngIf="latestAlerts.length === 0 && isTelemetryLoading">
            <tr>
              <td [attr.colspan]="6">
                <i  class="fa fa-fw fa-2x  fa-spin fa-spinner"></i>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
      <table class="table table-bordered table-striped"  id="dataTable1" width="100%" cellspacing="0" hidden
      *ngIf="isFilterSelected && filterObj.report_type === 'Alert Report'">
        <thead>
          <tr class="bg-secondary text-white">
            <th></th>
            <th>Asset Name</th>
            <th>Time</th>
            <th>Severity</th>
            <th>Description</th>
            <th>Status</th>
            <th>Acknowledged By</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="latestAlerts.length > 0">
            <tr *ngFor="let alert of latestAlerts" [ngClass]="{'bg-danger text-white': alert.severity?.toLowerCase() === 'critical'}">
              <td><i class="fa fa-exclamation-triangle" [style.color]="
                (alert.severity?.toLowerCase() === 'critical' ? '#cc0000' :
                (alert.severity?.toLowerCase() === 'error' ? '#fb5515' :
                (alert.severity?.toLowerCase() === 'warning' ? '#f6c23e' :
                (alert.severity?.toLowerCase() === 'informational' ? '#229954' : ''))
                )
                )" title="{{alert.severity}}"></i></td>

              <td>{{ alert.device_display_name ? alert.device_display_name : alert.device_id }}</td>

              <td>{{ alert.local_created_date }}</td>
              <td>{{alert.severity}}</td>
              <td>{{ alert.message }}</td>
              <td> {{alert.metadata?.acknowledged_date ? 'Acknowledged' : 'Not Acknowledged'}}
              </td>
              <td>{{ alert.metadata?.user_id }}</td>
            </tr>
          </ng-container>
          <ng-container *ngIf="latestAlerts.length === 0 && !isTelemetryLoading">
            <tr>
              <td colspan="6">No Alert data available.</td>
            </tr>
          </ng-container>
          <ng-container *ngIf="latestAlerts.length === 0 && isTelemetryLoading">
            <tr>
              <td [attr.colspan]="6">
                <i  class="fa fa-fw fa-2x  fa-spin fa-spinner"></i>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>
