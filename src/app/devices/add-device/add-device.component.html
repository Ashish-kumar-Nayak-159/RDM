<div class="modal right fade" id="createDeviceModal" tabindex="-1" role="dialog" aria-labelledby="ModalLabel2">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          {{isDeviceEditable ? ('Edit ' + (tileData?.table_key || 'Asset')) :
            ('Add New ' + (tileData?.table_key || 'Asset'))}}
        </h5>
        <button type="button" class="close" (click)="onCloseCreateDeviceModal()" aria-label="Close"
          [disabled]="isCreateDeviceAPILoading">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="deviceDetail">
        <form>
          <ng-container *ngIf="!isDeviceEditable">
          <div class="form-group">
            <label for="message-text" class="col-form-label">App:</label>
            <input type="text" class="form-control form-control-sm" id="app_name" [defaultValue]="contextApp.app" disabled>
          </div>
          <ng-container *ngFor="let level of contextApp?.hierarchy?.levels; let hIndex = index">
            <div class="form-group" *ngIf="hIndex !== 0">
              <label for="message-text" class="col-form-label">{{level}}:</label>
              <select class="form-control form-control-sm" id="hierarchy{{hIndex}}" name="hierarchy{{hIndex}}"
                [(ngModel)]="addDeviceConfigureHierarchy[hIndex]" [disabled]="contextApp.user.hierarchy[level]"
                (change)="onChangeOfAddDeviceHierarchy(hIndex)">
                <option [ngValue]="undefined"> Select {{level}}</option>
                <option [ngValue]="tag" *ngFor="let tag of addDeviceHierarchyArr[hIndex]">{{tag}}</option>
              </select>
            </div>
          </ng-container>
          <div class="form-group">
            <label for="message-text" class="col-form-label required">{{(tileData  ? tileData.table_key : '')}} Name:</label>
            <input type="text" class="form-control form-control-sm" id="device_name" name="device_id"
              [(ngModel)]="deviceDetail.device_id"
              placeholder="Enter {{(tileData  ? tileData.table_key : '')}} Name">
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label required">{{(tileData  ? tileData.table_key : '')}} Display Name:</label>
            <input type="text" class="form-control form-control-sm" id="device_name" name="device_id"
              [(ngModel)]="deviceDetail.tags.display_name"
              placeholder="Enter {{(tileData  ? tileData.table_key : '')}} Display Name">
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label required">{{(tileData  ? tileData.table_key : '')}} Manager:</label>
            <select class="form-control form-control-sm" id="user" name="user" [(ngModel)]="deviceDetail.tags.device_manager">
              <option [ngValue]="undefined">Select {{(tileData  ? tileData.table_key : '')}} Manager
              </option>
              <option *ngFor="let user of appUsers" [ngValue]="user">{{user.user_name}} ({{user.user_email}})</option>
            </select>
          </div>
          <div class="form-group" *ngIf="componentState === constantData.NON_IP_DEVICE">
            <label for="message-text" class="col-form-label">Gateway:</label>
            <select class="form-control form-control-sm" id="template" name="gateway_id" [(ngModel)]="deviceDetail.gateway_id">
              <option [ngValue]="undefined"> Select Gateway</option>
              <option *ngFor="let item of gateways" [ngValue]="item.device_id">
                {{item.display_name ? item.display_name : item.device_id}}</option>
            </select>
          </div>
          <!-- <div class="form-group" *ngIf="componentState === constantData.NON_IP_DEVICE">
            <label for="message-text" class="col-form-label required">Device Category:</label>
            <select class="form-control form-control-sm" id="template" name="gateway_id"
            [(ngModel)]="deviceDetail.tags.category">
              <option [ngValue]="undefined"> Select Device Category</option>
            <option *ngFor="let item of deviceCategory" [ngValue]="item.name">
              {{item.name}}</option>
            </select>
          </div> -->
          <div class="form-group" *ngIf="contextApp.metadata?.partition?.telemetry?.partition_strategy !== 'Device ID'">
            <label for="recipient-name" class="col-form-label">Partition Key:</label>
            <input type="text" class="form-control form-control-sm" id="partition_key" name="partition_key"
              [(ngModel)]="deviceDetail.tags.partition_key" placeholder="Partition Key">
          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label required">{{(tileData  ? tileData.table_key : '')}} Type:</label>
            <select class="form-control form-control-sm" id="device_type" name="device_type"
              [(ngModel)]="deviceDetail.tags.device_type" (change)="onChangeThingsModel()">
              <option [ngValue]="undefined"> Select {{(tileData  ? tileData.table_key : '')}} Type</option>
              <option *ngFor="let item of deviceTypes" [ngValue]="item.name">
                {{item.name}}</option>

            </select>

          </div>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Protocol:</label>
            <input type="text" class="form-control form-control-sm" id="protocol" name="protocol"
              [(ngModel)]="deviceDetail.tags.protocol" placeholder="Protocol" disabled>
          </div>

          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Cloud Connectivity followed by the {{(tileData  ? tileData.table_key : '')}}:</label>
            <input type="text" class="form-control form-control-sm" id="cloud_connectivity" name="cloud_connectivity"
              [(ngModel)]="deviceDetail.tags.cloud_connectivity" placeholder="Cloud Connectivity" disabled>
          </div>
          </ng-container>
          <form *ngIf="deviceDetail.tags.protocol && setupForm" [formGroup]="setupForm">
            <ng-container *ngIf="deviceDetail.tags.protocol === 'ModbusTCPMaster'">
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Host Address:</label>
                <div class="input-group">
                <input type="text" class="form-control form-control-sm" id="host_address" name="host_address"
                formControlName="host_address" placeholder="Host Address">
                </div>
                <div *ngIf="setupForm.get('host_address').invalid && (setupForm.get('host_address').dirty || setupForm.get('host_address').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('host_address').errors.required">
                  Host Address is required.
                </div>
                </div>
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Port Number:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="port_number" name="port_number"
                  formControlName="port_number" placeholder="Port Number">
                </div>
                <div *ngIf="setupForm.get('port_number').invalid && (setupForm.get('port_number').dirty || setupForm.get('port_number').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('port_number').errors.required">
                  Port Number is required.
                </div>
                </div>
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Slave ID:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="slave_id" name="slave_id"
                  formControlName="slave_id" placeholder="Slave ID">
                </div>
                <div *ngIf="setupForm.get('slave_id').invalid && (setupForm.get('slave_id').dirty || setupForm.get('slave_id').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('slave_id').errors.required">
                  Slave ID is required.
                </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="deviceDetail.tags.protocol === 'SiemensTCPIP'">
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Host Address:</label>
                <div class="input-group">
                <input type="text" class="form-control form-control-sm" id="host_address" name="host_address"
                formControlName="host_address" placeholder="Host Address">
                </div>
                <div *ngIf="setupForm.get('host_address').invalid && (setupForm.get('host_address').dirty || setupForm.get('host_address').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('host_address').errors.required">
                  Host Address is required.
                </div>
                </div>
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Rack:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="rack" name="rack"
                  formControlName="rack" placeholder="Rack">
                </div>
                <div *ngIf="setupForm.get('rack').invalid && (setupForm.get('rack').dirty || setupForm.get('rack').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('rack').errors.required">
                  Rack is required.
                </div>
                <div *ngIf="setupForm.get('rack').errors.min || setupForm.get('rack').errors.max">
                  Rack value must be between 0 and 7.
                </div>
                </div>

              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Slot:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="slot" name="slot"
                  formControlName="slot" placeholder="Slot">
                </div>
                <div *ngIf="setupForm.get('slot').invalid && (setupForm.get('slot').dirty || setupForm.get('slot').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('slot').errors.required">
                  Slot is required.
                </div>
                <div *ngIf="setupForm.get('slot').errors.min || setupForm.get('slot').errors.max">
                  Slot value must be between 0 and 31.
                </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="deviceDetail.tags.protocol === 'ModbusRTUMaster'">
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Baud Rate:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="baud_rate" name="baud_rate"
                formControlName="baud_rate" placeholder="Baud Rate">
                </div>
                <div *ngIf="setupForm.get('baud_rate').invalid && (setupForm.get('baud_rate').dirty || setupForm.get('baud_rate').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('baud_rate').errors.required">
                  Baud Rate is required.
                </div>
                </div>
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Data Bits:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="data_bits" name="data_bits"
                  formControlName="data_bits" placeholder="Data Bits">
                </div>
                <div *ngIf="setupForm.get('data_bits').invalid && (setupForm.get('data_bits').dirty || setupForm.get('data_bits').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('data_bits').errors.required">
                  Data Bits is required.
                </div>
                <div *ngIf="setupForm.get('data_bits').errors.min || setupForm.get('data_bits').errors.max">
                  Data Bits value must be between 5 and 9.
                </div>
                </div>
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Slave ID:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="slave_id" name="slave_id"
                  formControlName="slave_id" placeholder="Slave ID">
                </div>
                <div *ngIf="setupForm.get('slave_id').invalid && (setupForm.get('slave_id').dirty || setupForm.get('slave_id').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('slave_id').errors.required">
                  Slave ID is required.
                </div>
                </div>
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Parity:</label>
                <div class="input-group">
                <input type="number" class="form-control form-control-sm" id="parity" name="parity"
                  formControlName="parity" placeholder="Parity">
                </div>
                <div *ngIf="setupForm.get('parity').invalid && (setupForm.get('parity').dirty || setupForm.get('parity').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('parity').errors.required">
                  Parity is required.
                </div>
                <div *ngIf="setupForm.get('parity').errors.min || setupForm.get('parity').errors.max">
                  Parity value must be between 0 and 2.
                </div>
                </div>
              </div>
              <div class="form-group">
                <label for="recipient-name" class="col-form-label required">Stop Bits:</label>
                <div class="input-group">
                  <select class="form-control form-control-sm" id="stop_bits" name="stop_bits"
                  formControlName="stop_bits">
                  <option [ngValue]="null"> Select Stop Bits</option>
                  <option  [ngValue]="1">1</option>
                  <option  [ngValue]="1.5">1.5</option>
                  <option  [ngValue]="2">2</option>
                </select>
                </div>
                <div *ngIf="setupForm.get('stop_bits').invalid && (setupForm.get('stop_bits').dirty || setupForm.get('stop_bits').touched)"
                class="alert-danger">
                <div *ngIf="setupForm.get('stop_bits').errors.required">
                  Stop Bits is required.
                </div>
                </div>
              </div>
            </ng-container>
            </form>
        </form>
      </div>
      <div class="modal-footer">
        <button *ngIf="componentState === constantData.NON_IP_DEVICE" type="button" class="btn btn-primary add-row" [disabled]="(!setupForm?.valid && (setupForm?.touched || !setupForm?.touched)) ||isCreateDeviceAPILoading"
          (click)="isDeviceEditable ? onEditDevice() : onCreateDevice()">Save</button>
          <button *ngIf="componentState !== constantData.NON_IP_DEVICE" type="button" class="btn btn-primary add-row" [disabled]="isCreateDeviceAPILoading"
          (click)="isDeviceEditable ? onEditDevice() : onCreateDevice()">Save</button>
        <button type="button" class="btn btn-secondary" [disabled]="isCreateDeviceAPILoading"
          (click)="onCloseCreateDeviceModal()">
          Cancel
        </button>
        <i class="fa fa-spinner fa-spin fa-fw fa-2x" *ngIf="isCreateDeviceAPILoading"></i>
      </div>
    </div>
  </div>
</div>
